---
# TODO: This playbook is missing nginx entirely
- hosts: digitalocean
  user: root
  vars_files:
    - secrets.yml
  roles:
    - common
    - firewall
    - deploy-user
    - webserver-common
    - role: php-latest
      php_version: "5.5"
    - role: galaxy/nbz4live.php-fpm
      php_fpm_apt_packages:
        - php5
        - php5-gd
        - php5-json
        - php5-mysql
      php_fpm_pools:
        - name: lychee
          user: www-data
          group: www-data
          listen: /var/run/php-fpm/lychee.sock
          listen.owner: www-data
          listen.group: www-data
          listen.mode: "0660"
          pm: dynamic
          pm.max_children: 5
          pm.start_servers: 1
          pm.min_spare_servers: 1
          pm.max_spare_servers: 3
          chdir: /
    - role: galaxy/ANXS.mysql
      mysql_root_password: ''
      mysql_databases:
        - name: lychee
          collation: "utf8_general_ci"
          encoding: "utf8"
      mysql_users:
        - name: lychee
          pass: "4CMepo*NSaN9&m0e"
          priv: "lychee.*:ALL"
          host: "localhost"
    - role: lychee-app
      lychee_version: v3.0.9
