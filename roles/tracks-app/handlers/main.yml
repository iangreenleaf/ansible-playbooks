---
- name: Restart Nginx with updated vhost configuration
  action: service name=nginx state=restarted

- name: Remove the log directory
  file: path={{ app_location }}/current/log
        state=absent

- name: Symlink the log directory to the shared location
  file: path={{ app_location }}/current/log
        src={{ app_location }}/shared/log
        state=link
        force=yes
  sudo: yes
  sudo_user: deploy

- name: Symlink the tmp directory to the shared location
  file: path={{ app_location }}/current/tmp
        src={{ app_location }}/shared/tmp
        state=link
        force=yes
  sudo: yes
  sudo_user: deploy

- name: restart mysql
  action: service name=mysql enabled=yes state=restarted

#TODO do this natively, I think
- name: restart tracks
  command: "{{ item }}"
  sudo: yes
  sudo_user: deploy
  with_items:
    - touch {{ app_location }}/current/tmp/restart.txt
